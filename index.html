<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Operaciones con Matrices</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding: 30px;
            backdrop-filter: blur(10px);
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eaeaea;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5rem;
            background: linear-gradient(90deg, #2575fc, #6a11cb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .description {
            color: #7f8c8d;
            font-size: 1.1rem;
            max-width: 900px;
            margin: 0 auto;
            line-height: 1.8;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1.5fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .input-section {
            background: linear-gradient(145deg, #ffffff, #f0f0f0);
            border-radius: 12px;
            padding: 25px;
            border: 1px solid #ddd;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .result-section {
            background: linear-gradient(145deg, #ffffff, #f0f0f0);
            border-radius: 12px;
            padding: 25px;
            border: 1px solid #ddd;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        h2 {
            color: #3498db;
            margin-bottom: 20px;
            font-size: 1.6rem;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 1rem;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
            background-color: white;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .matrix-config {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 5px solid #3498db;
        }
        
        .matrix-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .matrix-controls > div {
            flex: 1;
            min-width: 150px;
        }
        
        .matrices-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
            max-height: 500px;
            overflow-y: auto;
            padding: 10px;
        }
        
        .matrix-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .matrix-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
            border-color: #3498db;
        }
        
        .matrix-card h3 {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: #2c3e50;
            text-align: center;
            background-color: #f8f9fa;
            padding: 8px;
            border-radius: 6px;
        }
        
        .matrix-grid {
            display: grid;
            gap: 8px;
            margin: 0 auto;
            justify-content: center;
        }
        
        .matrix-cell {
            width: 60px;
            height: 60px;
            text-align: center;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 1.1rem;
            font-weight: 600;
            background-color: white;
            transition: all 0.2s;
        }
        
        .matrix-cell:focus {
            border-color: #3498db;
            background-color: #f0f8ff;
            outline: none;
        }
        
        .operation-container {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #2ecc71;
        }
        
        .operation-input-container {
            margin-top: 15px;
        }
        
        .operation-examples {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-top: 8px;
            padding: 10px;
            background-color: white;
            border-radius: 6px;
            border: 1px dashed #ddd;
        }
        
        .buttons-container {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 14px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex: 1;
            min-width: 180px;
        }
        
        .btn-primary {
            background: linear-gradient(90deg, #3498db, #2980b9);
            color: white;
        }
        
        .btn-primary:hover {
            background: linear-gradient(90deg, #2980b9, #2573a7);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(90deg, #2ecc71, #27ae60);
            color: white;
        }
        
        .btn-success:hover {
            background: linear-gradient(90deg, #27ae60, #219955);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.4);
        }
        
        .btn-export {
            background: linear-gradient(90deg, #9b59b6, #8e44ad);
            color: white;
        }
        
        .btn-export:hover {
            background: linear-gradient(90deg, #8e44ad, #7d3c98);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(155, 89, 182, 0.4);
        }
        
        .btn-clear {
            background: linear-gradient(90deg, #e74c3c, #c0392b);
            color: white;
        }
        
        .btn-clear:hover {
            background: linear-gradient(90deg, #c0392b, #a93226);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
        }
        
        .result-display {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            margin-top: 20px;
            border: 2px solid #eaeaea;
            min-height: 300px;
            overflow-x: auto;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .result-matrix {
            display: inline-block;
            margin: 20px auto;
            text-align: center;
        }
        
        .matrix-row {
            display: flex;
            justify-content: center;
            margin-bottom: 5px;
        }
        
        .result-cell {
            width: 70px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 3px solid #3498db;
            margin: 0 3px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1.3rem;
            background: linear-gradient(145deg, #f0f8ff, #e3f2fd);
            color: #2c3e50;
            box-shadow: 0 3px 5px rgba(0,0,0,0.1);
        }
        
        .operation-expression {
            font-size: 1.3rem;
            margin-bottom: 20px;
            padding: 20px;
            background: linear-gradient(145deg, #e3f2fd, #bbdefb);
            border-radius: 10px;
            border-left: 5px solid #3498db;
            font-weight: 600;
            color: #2c3e50;
            text-align: center;
        }
        
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
        }
        
        .alert-error {
            background-color: #ffeaea;
            color: #e74c3c;
            border-left: 5px solid #e74c3c;
        }
        
        .alert-success {
            background-color: #eaffea;
            color: #27ae60;
            border-left: 5px solid #27ae60;
        }
        
        .instructions {
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
            padding: 25px;
            border-radius: 12px;
            margin-top: 40px;
            border-left: 8px solid #2ecc71;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .instructions h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.4rem;
        }
        
        .instructions ul {
            padding-left: 25px;
            margin-bottom: 20px;
        }
        
        .instructions li {
            margin-bottom: 10px;
            line-height: 1.7;
        }
        
        .instructions code {
            background-color: #2c3e50;
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 1rem;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid #eaeaea;
            color: #7f8c8d;
            font-size: 0.95rem;
        }
        
        .matrix-info {
            font-size: 0.9rem;
            color: #7f8c8d;
            text-align: center;
            margin-top: 10px;
            font-style: italic;
        }
        
        .dimension-info {
            display: inline-block;
            background-color: #3498db;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9rem;
            margin-left: 10px;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .btn {
                min-width: 100%;
            }
            
            .matrix-controls {
                flex-direction: column;
            }
            
            .matrices-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Simulador de Operaciones con Matrices</h1>
            <p class="description">
                Realiza operaciones con matrices usando enteros: suma (+), resta (-), multiplicaci√≥n (*), 
                multiplicaci√≥n por escalar (k*A), y operaciones combinadas como A+3*B. 
                Ingresa manualmente las matrices y la operaci√≥n, y exporta los resultados a PDF.
            </p>
        </header>
        
        <div class="main-content">
            <div class="input-section">
                <h2>Configuraci√≥n</h2>
                
                <div class="matrix-config">
                    <h3>Configurar Matrices</h3>
                    <div class="matrix-controls">
                        <div class="form-group">
                            <label for="matrixCount">Cantidad de matrices:</label>
                            <select id="matrixCount">
                                <option value="2">2 matrices (A, B)</option>
                                <option value="3">3 matrices (A, B, C)</option>
                                <option value="4">4 matrices (A, B, C, D)</option>
                                <option value="5">5 matrices (A, B, C, D, E)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="rows">Filas:</label>
                            <input type="number" id="rows" min="1" max="8" value="3">
                        </div>
                        
                        <div class="form-group">
                            <label for="cols">Columnas:</label>
                            <input type="number" id="cols" min="1" max="8" value="3">
                        </div>
                    </div>
                    
                    <button id="generateMatrices" class="btn btn-primary">
                        <span>üé≤</span> Generar Matrices Aleatorias
                    </button>
                </div>
                
                <div class="operation-container">
                    <h3>Operaci√≥n a Realizar</h3>
                    <div class="form-group">
                        <label for="operationExpression">Expresi√≥n de operaci√≥n:</label>
                        <textarea id="operationExpression" rows="3" placeholder="Ejemplo: A + 3*B - 2*C">A + 2*B</textarea>
                        <div class="operation-examples">
                            <strong>Ejemplos v√°lidos:</strong><br>
                            ‚Ä¢ A + B (suma)<br>
                            ‚Ä¢ A - B (resta)<br>
                            ‚Ä¢ A * B (multiplicaci√≥n)<br>
                            ‚Ä¢ 3*A (multiplicaci√≥n por escalar)<br>
                            ‚Ä¢ A + 2*B - 3*C (combinada)<br>
                            ‚Ä¢ (A + B) * C (con par√©ntesis)
                        </div>
                    </div>
                </div>
                
                <div id="matricesContainer" class="matrices-container">
                    <!-- Las matrices se generar√°n aqu√≠ -->
                </div>
                
                <div class="buttons-container">
                    <button id="calculateBtn" class="btn btn-success">
                        <span>üßÆ</span> Calcular Resultado
                    </button>
                    <button id="clearBtn" class="btn btn-clear">
                        <span>üóëÔ∏è</span> Limpiar Todo
                    </button>
                </div>
            </div>
            
            <div class="result-section">
                <h2>Resultado</h2>
                
                <div class="operation-expression" id="currentOperation">
                    Operaci√≥n: A + 2*B
                </div>
                
                <div class="result-display" id="resultDisplay">
                    <p style="text-align: center; color: #7f8c8d; margin-top: 50px;">
                        El resultado aparecer√° aqu√≠ despu√©s de calcular.
                    </p>
                </div>
                
                <div class="alert alert-error" id="errorMessage">
                    <strong>Error:</strong> Las dimensiones de las matrices no son compatibles para esta operaci√≥n.
                </div>
                
                <div class="alert alert-success" id="successMessage">
                    <strong>√âxito:</strong> Operaci√≥n realizada correctamente. Puedes exportar el resultado.
                </div>
                
                <div class="buttons-container">
                    <button id="exportBtn" class="btn btn-export" disabled>
                        <span>üìÑ</span> Exportar a PDF
                    </button>
                </div>
            </div>
        </div>
        
        <div class="instructions">
            <h3>Instrucciones de Uso</h3>
            <ul>
                <li><strong>Configura las matrices:</strong> Selecciona la cantidad de matrices y sus dimensiones (filas √ó columnas).</li>
                <li><strong>Ingresa los valores:</strong> Completa los valores en cada celda de las matrices. Solo se aceptan n√∫meros enteros.</li>
                <li><strong>Escribe la operaci√≥n:</strong> Usa la expresi√≥n matem√°tica con los nombres de matrices (A, B, C...) y operadores (+, -, *).</li>
                <li><strong>Ejemplos v√°lidos:</strong>
                    <ul>
                        <li><code>A + B</code> - Suma de matrices A y B</li>
                        <li><code>A - B</code> - Resta de matrices A y B</li>
                        <li><code>A * B</code> - Multiplicaci√≥n de matrices A y B</li>
                        <li><code>3*A</code> - Multiplicaci√≥n de matriz A por escalar 3</li>
                        <li><code>A + 2*B - C</code> - Operaci√≥n combinada</li>
                        <li><code>(A + B) * C</code> - Con par√©ntesis para prioridad</li>
                    </ul>
                </li>
                <li><strong>Haz clic en "Calcular Resultado"</strong> para realizar la operaci√≥n.</li>
                <li><strong>Exporta el resultado</strong> a PDF cuando est√© listo.</li>
            </ul>
            <p><strong>Nota:</strong> Todas las operaciones devuelven resultados en n√∫meros enteros. Para multiplicaci√≥n de matrices, el n√∫mero de columnas de la primera debe igualar al n√∫mero de filas de la segunda.</p>
        </div>
        
        <footer>
            <p>Simulador de Operaciones con Matrices &copy; 2023 | Todos los c√°lculos se realizan con n√∫meros enteros</p>
        </footer>
    </div>

    <script>
        // Variables globales
        let matrices = [];
        let matrixCount = 2;
        let rows = 3, cols = 3;
        let operationResult = null;
        let currentExpression = "A + 2*B";
        
        // Referencias a elementos DOM
        const matrixCountSelect = document.getElementById('matrixCount');
        const rowsInput = document.getElementById('rows');
        const colsInput = document.getElementById('cols');
        const operationExpressionInput = document.getElementById('operationExpression');
        const generateMatricesBtn = document.getElementById('generateMatrices');
        const calculateBtn = document.getElementById('calculateBtn');
        const clearBtn = document.getElementById('clearBtn');
        const exportBtn = document.getElementById('exportBtn');
        const matricesContainer = document.getElementById('matricesContainer');
        const resultDisplay = document.getElementById('resultDisplay');
        const currentOperation = document.getElementById('currentOperation');
        const errorMessage = document.getElementById('errorMessage');
        const successMessage = document.getElementById('successMessage');
        
        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar valores iniciales
            operationExpressionInput.value = currentExpression;
            
            // Generar matrices iniciales
            generateMatrixInputs();
            
            // Configurar event listeners
            matrixCountSelect.addEventListener('change', function() {
                matrixCount = parseInt(this.value);
                generateMatrixInputs();
            });
            
            rowsInput.addEventListener('change', function() {
                rows = Math.max(1, Math.min(8, parseInt(this.value) || 3));
                this.value = rows;
                generateMatrixInputs();
            });
            
            colsInput.addEventListener('change', function() {
                cols = Math.max(1, Math.min(8, parseInt(this.value) || 3));
                this.value = cols;
                generateMatrixInputs();
            });
            
            operationExpressionInput.addEventListener('input', function() {
                currentExpression = this.value.trim() || "A + B";
                currentOperation.textContent = `Operaci√≥n: ${currentExpression}`;
            });
            
            generateMatricesBtn.addEventListener('click', function() {
                generateMatrixInputs(true); // Con valores aleatorios
            });
            
            calculateBtn.addEventListener('click', calculateOperation);
            clearBtn.addEventListener('click', clearAll);
            exportBtn.addEventListener('click', exportToPDF);
            
            // Actualizar operaci√≥n inicial
            currentOperation.textContent = `Operaci√≥n: ${currentExpression}`;
        });
        
        // Generar inputs para las matrices
        function generateMatrixInputs(randomValues = false) {
            matricesContainer.innerHTML = '';
            matrices = [];
            
            const matrixNames = ['A', 'B', 'C', 'D', 'E'];
            
            for (let i = 0; i < matrixCount; i++) {
                const matrixCard = document.createElement('div');
                matrixCard.className = 'matrix-card';
                
                const matrixName = matrixNames[i];
                matrixCard.innerHTML = `
                    <h3>Matriz ${matrixName} <span class="dimension-info">${rows}√ó${cols}</span></h3>
                    <div class="matrix-grid" id="matrix-${matrixName}" style="grid-template-columns: repeat(${cols}, 1fr);">
                        <!-- Celdas se generar√°n aqu√≠ -->
                    </div>
                    <p class="matrix-info">Ingresa solo n√∫meros enteros</p>
                `;
                
                const matrixGrid = matrixCard.querySelector(`#matrix-${matrixName}`);
                
                // Crear celdas de la matriz
                for (let r = 0; r < rows; r++) {
                    for (let c = 0; c < cols; c++) {
                        const input = document.createElement('input');
                        input.type = 'number';
                        input.className = 'matrix-cell';
                        input.step = '1';
                        input.value = randomValues ? Math.floor(Math.random() * 21) - 10 : (r === c ? 1 : 0);
                        input.setAttribute('data-row', r);
                        input.setAttribute('data-col', c);
                        input.setAttribute('data-matrix', matrixName);
                        matrixGrid.appendChild(input);
                    }
                }
                
                matricesContainer.appendChild(matrixCard);
            }
        }
        
        // Obtener valores de las matrices desde los inputs
        function getMatricesValues() {
            const matrixValues = {};
            const matrixNames = ['A', 'B', 'C', 'D', 'E'].slice(0, matrixCount);
            
            // Inicializar matrices vac√≠as
            matrixNames.forEach(name => {
                matrixValues[name] = createMatrix(rows, cols);
            });
            
            // Obtener valores de los inputs
            const inputs = document.querySelectorAll('.matrix-cell');
            inputs.forEach(input => {
                const row = parseInt(input.getAttribute('data-row'));
                const col = parseInt(input.getAttribute('data-col'));
                const matrixName = input.getAttribute('data-matrix');
                const value = parseInt(input.value) || 0;
                
                if (matrixValues[matrixName]) {
                    matrixValues[matrixName][row][col] = value;
                }
            });
            
            return matrixValues;
        }
        
        // Crear una matriz vac√≠a
        function createMatrix(rows, cols) {
            const matrix = [];
            for (let i = 0; i < rows; i++) {
                matrix[i] = [];
                for (let j = 0; j < cols; j++) {
                    matrix[i][j] = 0;
                }
            }
            return matrix;
        }
        
        // Suma de matrices
        function addMatrices(A, B) {
            if (A.length !== B.length || A[0].length !== B[0].length) {
                throw new Error("Las matrices deben tener las mismas dimensiones para la suma");
            }
            
            const result = createMatrix(A.length, A[0].length);
            for (let i = 0; i < A.length; i++) {
                for (let j = 0; j < A[0].length; j++) {
                    result[i][j] = A[i][j] + B[i][j];
                }
            }
            return result;
        }
        
        // Resta de matrices
        function subtractMatrices(A, B) {
            if (A.length !== B.length || A[0].length !== B[0].length) {
                throw new Error("Las matrices deben tener las mismas dimensiones para la resta");
            }
            
            const result = createMatrix(A.length, A[0].length);
            for (let i = 0; i < A.length; i++) {
                for (let j = 0; j < A[0].length; j++) {
                    result[i][j] = A[i][j] - B[i][j];
                }
            }
            return result;
        }
        
        // Multiplicaci√≥n de matrices
        function multiplyMatrices(A, B) {
            const rowsA = A.length, colsA = A[0].length;
            const rowsB = B.length, colsB = B[0].length;
            
            if (colsA !== rowsB) {
                throw new Error(`No se pueden multiplicar: columnas de A (${colsA}) ‚â† filas de B (${rowsB})`);
            }
            
            const result = createMatrix(rowsA, colsB);
            for (let i = 0; i < rowsA; i++) {
                for (let j = 0; j < colsB; j++) {
                    let sum = 0;
                    for (let k = 0; k < colsA; k++) {
                        sum += A[i][k] * B[k][j];
                    }
                    result[i][j] = sum;
                }
            }
            return result;
        }
        
        // Multiplicaci√≥n por escalar
        function scalarMultiply(matrix, scalar) {
            const result = createMatrix(matrix.length, matrix[0].length);
            for (let i = 0; i < matrix.length; i++) {
                for (let j = 0; j < matrix[0].length; j++) {
                    result[i][j] = matrix[i][j] * scalar;
                }
            }
            return result;
        }
        
        // Evaluar expresi√≥n matem√°tica con matrices
        function evaluateExpression(expression, matrices) {
            // Preprocesar la expresi√≥n
            let expr = expression.replace(/\s+/g, '').toUpperCase();
            
            // Validar caracteres
            if (!/^[A-E0-9+\-*()]+$/.test(expr)) {
                throw new Error("La expresi√≥n contiene caracteres no v√°lidos");
            }
            
            // Reemplazar multiplicaciones impl√≠citas (ej: 3A -> 3*A)
            expr = expr.replace(/(\d+)([A-E])/g, '$1*$2');
            expr = expr.replace(/([A-E])(\d+)/g, '$1*$2');
            expr = expr.replace(/\)\(/g, ')*(');
            
            // Convertir a tokens
            const tokens = tokenize(expr);
            
            // Convertir a notaci√≥n polaca inversa (RPN)
            const rpn = shuntingYard(tokens);
            
            // Evaluar RPN
            return evaluateRPN(rpn, matrices);
        }
        
        // Tokenizar expresi√≥n
        function tokenize(expression) {
            const tokens = [];
            let currentToken = '';
            
            for (let char of expression) {
                if (char.match(/[A-E]/)) {
                    // Es una matriz
                    if (currentToken.match(/\d+/)) {
                        tokens.push(currentToken); // N√∫mero
                        tokens.push('*'); // Multiplicaci√≥n impl√≠cita
                        currentToken = '';
                    }
                    tokens.push(char);
                } else if (char.match(/[0-9]/)) {
                    // Es un n√∫mero
                    currentToken += char;
                } else {
                    // Es un operador o par√©ntesis
                    if (currentToken) {
                        tokens.push(currentToken);
                        currentToken = '';
                    }
                    tokens.push(char);
                }
            }
            
            if (currentToken) {
                tokens.push(currentToken);
            }
            
            return tokens;
        }
        
        // Algoritmo Shunting Yard para convertir a RPN
        function shuntingYard(tokens) {
            const output = [];
            const operators = [];
            const precedence = {
                '+': 1,
                '-': 1,
                '*': 2
            };
            
            for (let token of tokens) {
                if (token.match(/[A-E]|\d+/)) {
                    // Matriz o n√∫mero
                    output.push(token);
                } else if (token === '(') {
                    operators.push(token);
                } else if (token === ')') {
                    while (operators.length && operators[operators.length - 1] !== '(') {
                        output.push(operators.pop());
                    }
                    operators.pop(); // Remover '('
                } else if (token in precedence) {
                    // Operador
                    while (operators.length && 
                           operators[operators.length - 1] !== '(' &&
                           precedence[operators[operators.length - 1]] >= precedence[token]) {
                        output.push(operators.pop());
                    }
                    operators.push(token);
                }
            }
            
            while (operators.length) {
                output.push(operators.pop());
            }
            
            return output;
        }
        
        // Evaluar expresi√≥n en notaci√≥n polaca inversa
        function evaluateRPN(rpn, matrices) {
            const stack = [];
            
            for (let token of rpn) {
                if (token.match(/[A-E]/)) {
                    // Matriz
                    if (!matrices[token]) {
                        throw new Error(`Matriz ${token} no definida`);
                    }
                    stack.push(matrices[token]);
                } else if (token.match(/\d+/)) {
                    // N√∫mero
                    stack.push(parseInt(token));
                } else {
                    // Operador
                    const b = stack.pop();
                    const a = stack.pop();
                    
                    if (typeof a === 'number' && Array.isArray(b)) {
                        // Escalar * Matriz
                        stack.push(scalarMultiply(b, a));
                    } else if (Array.isArray(a) && typeof b === 'number') {
                        // Matriz * Escalar
                        stack.push(scalarMultiply(a, b));
                    } else if (Array.isArray(a) && Array.isArray(b)) {
                        // Matriz op Matriz
                        if (token === '+') {
                            stack.push(addMatrices(a, b));
                        } else if (token === '-') {
                            stack.push(subtractMatrices(a, b));
                        } else if (token === '*') {
                            stack.push(multiplyMatrices(a, b));
                        }
                    } else {
                        throw new Error("Operaci√≥n no v√°lida");
                    }
                }
            }
            
            if (stack.length !== 1) {
                throw new Error("Expresi√≥n no v√°lida");
            }
            
            const result = stack[0];
            if (!Array.isArray(result)) {
                throw new Error("El resultado debe ser una matriz");
            }
            
            return result;
        }
        
        // Calcular la operaci√≥n
        function calculateOperation() {
            try {
                // Ocultar mensajes anteriores
                errorMessage.style.display = 'none';
                successMessage.style.display = 'none';
                
                // Obtener matrices y expresi√≥n
                const matrices = getMatricesValues();
                const expression = operationExpressionInput.value.trim() || "A + B";
                
                // Validar expresi√≥n
                if (!expression) {
                    throw new Error("Debe ingresar una expresi√≥n");
                }
                
                // Evaluar expresi√≥n
                const result = evaluateExpression(expression, matrices);
                
                // Guardar resultado
                operationResult = result;
                
                // Actualizar operaci√≥n mostrada
                currentOperation.textContent = `Operaci√≥n: ${expression}`;
                
                // Mostrar resultado
                displayResult(result);
                
                // Mostrar mensaje de √©xito
                successMessage.style.display = 'block';
                
                // Habilitar exportaci√≥n
                exportBtn.disabled = false;
                
            } catch (error) {
                // Mostrar error
                errorMessage.innerHTML = `<strong>Error:</strong> ${error.message}`;
                errorMessage.style.display = 'block';
                exportBtn.disabled = true;
            }
        }
        
        // Mostrar resultado
        function displayResult(matrix) {
            resultDisplay.innerHTML = '';
            
            const title = document.createElement('h3');
            title.textContent = 'Matriz Resultado:';
            title.style.textAlign = 'center';
            title.style.marginBottom = '20px';
            title.style.color = '#2c3e50';
            resultDisplay.appendChild(title);
            
            const resultMatrix = document.createElement('div');
            resultMatrix.className = 'result-matrix';
            
            for (let i = 0; i < matrix.length; i++) {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'matrix-row';
                
                for (let j = 0; j < matrix[i].length; j++) {
                    const cellDiv = document.createElement('div');
                    cellDiv.className = 'result-cell';
                    cellDiv.textContent = matrix[i][j];
                    rowDiv.appendChild(cellDiv);
                }
                
                resultMatrix.appendChild(rowDiv);
            }
            
            resultDisplay.appendChild(resultMatrix);
            
            // Mostrar dimensiones
            const dimensions = document.createElement('p');
            dimensions.style.textAlign = 'center';
            dimensions.style.marginTop = '20px';
            dimensions.style.fontSize = '1.1rem';
            dimensions.style.color = '#3498db';
            dimensions.style.fontWeight = '600';
            dimensions.innerHTML = `Dimensiones: <span style="background-color:#3498db; color:white; padding:5px 10px; border-radius:5px;">${matrix.length} √ó ${matrix[0].length}</span>`;
            resultDisplay.appendChild(dimensions);
        }
        
        // Exportar a PDF
        function exportToPDF() {
            if (!operationResult) return;
            
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Configuraci√≥n inicial
                doc.setFontSize(20);
                doc.setTextColor(41, 128, 185);
                doc.text('Resultado de Operaci√≥n con Matrices', 20, 25);
                
                // Fecha y hora
                const now = new Date();
                doc.setFontSize(10);
                doc.setTextColor(100, 100, 100);
                doc.text(`Generado: ${now.toLocaleDateString()} ${now.toLocaleTimeString()}`, 20, 35);
                
                // Operaci√≥n realizada
                doc.setFontSize(14);
                doc.setTextColor(0, 0, 0);
                doc.text(`Operaci√≥n: ${currentExpression}`, 20, 50);
                
                // Matrices de entrada
                const matrices = getMatricesValues();
                const matrixNames = Object.keys(matrices);
                let yPosition = 65;
                
                doc.setFontSize(12);
                doc.setTextColor(52, 73, 94);
                doc.text('Matrices de entrada:', 20, yPosition);
                yPosition += 10;
                
                // Mostrar cada matriz
                for (let i = 0; i < matrixNames.length; i++) {
                    const name = matrixNames[i];
                    const matrix = matrices[name];
                    
                    // T√≠tulo de la matriz
                    doc.setFontSize(11);
                    doc.text(`Matriz ${name}:`, 20, yPosition);
                    yPosition += 7;
                    
                    // Crear tabla para la matriz
                    const tableData = [];
                    for (let r = 0; r < matrix.length; r++) {
                        tableData.push(matrix[r]);
                    }
                    
                    doc.autoTable({
                        startY: yPosition,
                        head: [Array.from({length: matrix[0].length}, (_, i) => `Col ${i+1}`)],
                        body: tableData,
                        margin: { left: 20 },
                        tableWidth: 'auto',
                        styles: { 
                            fontSize: 10, 
                            cellPadding: 3,
                            cellWidth: 'auto',
                            textColor: [0, 0, 0]
                        },
                        headStyles: {
                            fillColor: [52, 152, 219],
                            textColor: [255, 255, 255]
                        }
                    });
                    
                    yPosition = doc.lastAutoTable.finalY + 10;
                    
                    // Salto de p√°gina si es necesario
                    if (yPosition > 250 && i < matrixNames.length - 1) {
                        doc.addPage();
                        yPosition = 20;
                    }
                }
                
                // Resultado
                doc.addPage();
                doc.setFontSize(16);
                doc.setTextColor(41, 128, 185);
                doc.text('Resultado de la Operaci√≥n', 20, 25);
                
                doc.setFontSize(12);
                doc.setTextColor(0, 0, 0);
                doc.text(`Operaci√≥n: ${currentExpression}`, 20, 40);
                doc.text(`Dimensiones: ${operationResult.length} √ó ${operationResult[0].length}`, 20, 50);
                
                // Crear tabla para el resultado
                const resultData = [];
                for (let r = 0; r < operationResult.length; r++) {
                    resultData.push(operationResult[r]);
                }
                
                doc.autoTable({
                    startY: 60,
                    head: [Array.from({length: operationResult[0].length}, (_, i) => `Col ${i+1}`)],
                    body: resultData,
                    margin: { left: 20 },
                    tableWidth: 'auto',
                    styles: { 
                        fontSize: 11, 
                        cellPadding: 4,
                        cellWidth: 'auto',
                        textColor: [0, 0, 0],
                        fontStyle: 'bold'
                    },
                    headStyles: {
                        fillColor: [46, 204, 113],
                        textColor: [255, 255, 255]
                    }
                });
                
                // Guardar PDF
                doc.save('resultado-matrices.pdf');
                
            } catch (error) {
                alert(`Error al generar PDF: ${error.message}`);
            }
        }
        
        // Limpiar todo
        function clearAll() {
            // Restablecer valores
            matrixCountSelect.value = '2';
            rowsInput.value = '3';
            colsInput.value = '3';
            operationExpressionInput.value = 'A + 2*B';
            currentExpression = 'A + 2*B';
            
            // Ocultar mensajes
            errorMessage.style.display = 'none';
            successMessage.style.display = 'none';
            
            // Limpiar resultado
            resultDisplay.innerHTML = '<p style="text-align: center; color: #7f8c8d; margin-top: 50px;">El resultado aparecer√° aqu√≠ despu√©s de calcular.</p>';
            currentOperation.textContent = `Operaci√≥n: ${currentExpression}`;
            
            // Deshabilitar exportaci√≥n
            exportBtn.disabled = true;
            
            // Regenerar matrices
            matrixCount = 2;
            rows = 3;
            cols = 3;
            generateMatrixInputs();
        }
    </script>
</body>
</html>